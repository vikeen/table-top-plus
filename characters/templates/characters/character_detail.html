{% extends "characters/character_base.html" %}
{% load bootstrap3 %}

{% block content %}
    <div class="row">
        <div class="col-xs-12 col-md-4">
            <h1>{{ object.name }}</h1>
            <hr>
            {% buttons %}
                <a href="{% url 'characters:delete' object.id %}" class="btn btn-danger">Delete</a>
            {% endbuttons %}
        </div>
        <div class="col-xs-12 col-md-8">
            <canvas id="the-canvas"></canvas>
        </div>
    </div>

    <script>
        var pdfDoc = null,
            pageNum = 1,
            pageRendering = false,
            pageNumPending = null,
            scale = 1.3,
            canvas = document.getElementById('the-canvas'),
            ctx = canvas.getContext('2d');

        function renderPage(num) {
            pageRendering = true;
            pdfDoc.getPage(num).then(function (page) {
                var viewport = page.getViewport(scale);

                canvas.height = viewport.height;
                canvas.width = viewport.width;

                var renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                var renderTask = page.render(renderContext);
                // Wait for rendering to finish
                renderTask.promise.then(function () {
                    pageRendering = false;
                    if (pageNumPending !== null) {
                        // New page rendering is pending
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });
        }

        PDFJS.getDocument('/static/characters/images/dnd-5e-character-sheet_1.pdf').then(function (pdfDoc_) {
            pdfDoc = pdfDoc_;

            renderPage(pageNum);
        });
    </script>
{% endblock %}